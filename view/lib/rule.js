(function(c,a){if(typeof define==="function"&&define.amd){define(["exports","module"],a)}else{if(typeof exports!=="undefined"&&typeof module!=="undefined"){a(exports,module)}else{var b={exports:{}};a(b.exports,b);c.Rule=b.exports}}})(this,function(e,b){var d=(function(){function j(n,l){for(var k=0;k<l.length;k++){var m=l[k];m.enumerable=m.enumerable||false;m.configurable=true;if("value" in m){m.writable=true}Object.defineProperty(n,m.key,m)}}return function(m,k,l){if(k){j(m.prototype,k)}if(l){j(m,l)}return m}})();function i(j){if(Array.isArray(j)){for(var l=0,k=Array(j.length);l<j.length;l++){k[l]=j[l]}return k}else{return Array.from(j)}}function f(j,k){if(!(j instanceof k)){throw new TypeError("Cannot call a class as a function")}}var h=/(^\s*)|(\s*$)/g;var a=(function(){function l(r){var q=arguments.length<=1||arguments[1]===undefined?false:arguments[1];f(this,l);this.$dom=this.query(r);this.data={};this.validator=new c();this.load();this.listen(q)}d(l,[{key:"load",value:function o(){var r=this;var q=this.query("[l-validate]",true,this.$dom);q.forEach(function(s){if(r.data[s.name]){console.warn("field "+s.name+" exist!");return}r.data[s.name]=new g(s)})}},{key:"listen",value:function k(q){var r=this;q&&this.$dom.setAttribute("novalidate",true);this.$dom.onsubmit=function(){var s=r.validate();if(s&&!q){return true}return false}}},{key:"validate",value:function p(){var s=this;var v={};for(var r in this.data){var t=this.data[r];var u=function(y){var x=t.validate[y];var z=s.validator.validates[x[0]];if(z){var w=undefined;if(z.flag){w=z.fn.apply(s,[t.$dom.value,t].concat(i(x[1])))}else{w=z.fn.apply(s,[t.$dom.value].concat(i(x[1])))}if(!w){(function(){!v[t.name]&&(v[t.name]=[]);var A=z.errorInfo;if(x[1].length){if(z.argvs[0]=="*"){A=A.replace("{{*}}",x[1].join(","))}else{x[1].map(function(C,B){A=A.replace("{{"+z.argvs[B]+"}}",C)})}}v[t.name].push(A||"no error info")})()}}};for(var q=0;q<t.validate.length;q++){u(q)}}this.validateCallBack&&this.validateCallBack(v);return !Object.keys(v).length}},{key:"submit",value:function n(q){this.validateCallBack=q}},{key:"query",value:function m(t){var r=arguments.length<=1||arguments[1]===undefined?false:arguments[1];var q=arguments.length<=2||arguments[2]===undefined?document:arguments[2];if(r){return q.querySelectorAll(t)}else{return q.querySelector(t)}}},{key:"get",value:function j(s){var r=this;if(s){return this.data[s].$dom.value}else{var q=(function(){var t={};Object.keys(r.data).map(function(u){t[u]=r.data[u].$dom.value});return{v:t}})();if(typeof q==="object"){return q.v}}}}]);return l})();var g=(function(){function j(m){f(this,j);this.$dom=m;this.name=m.name;this.loadValidate(m.getAttribute("l-validate"))}d(j,[{key:"getValidate",value:function k(m){return this.validate.filter(function(n){if(m){if(n[0]==m){return true}}else{true}}).map(function(n){return n[0]})}},{key:"loadValidate",value:function l(n){var m=n.split("|").map(function(o){return o.replace(h,"")});this.validate=m.filter(function(o){return o.length}).map(function(q){var p=q.split(":");var o=[null,[]];o[0]=p[0];p[1]&&(o[1]=p[1].split(","));return o})}}]);return j})();var c=(function(){function l(){f(this,l);this.validates={};this.load()}d(l,[{key:"load",value:function m(){this.create("required|Value cannot be empty",function(n){if(n.length>0){return true}return false});this.create("filled|Value cannot be an empty string",function(n){n=n.replace(h,"");if(n>0){return true}return false});this.create("number|Value cannot be not number",function(n){if(n.length>0&&!isNaN(n)){return true}return false});this.create("max:num|Value max - {{num}}",function(p,o,n){if(o.getValidate("number").length){if(parseFloat(p)<=parseFloat(n)){return true}}else{if(p.length<=n){return true}}return false},true);this.create("min:num|Value min - {{num}}",function(p,o,n){if(o.getValidate("number").length&&parseFloat(p)>=parseFloat(n)){return true}else{if(p.length>=n){return true}}return false},true);this.create("include:*|Value exists {{*}}",function(r){for(var o=arguments.length,n=Array(o>1?o-1:0),q=1;q<o;q++){n[q-1]=arguments[q]}for(var p=0;p<n.length;p++){if(n[p]==r){return true}}return false});this.create("dbpassword|Password mismatch",function(n){if(this.get("password")==n){return true}return false})}},{key:"create",value:function k(s,t){var o=arguments.length<=2||arguments[2]===undefined?false:arguments[2];if(!s){console.error("rule name dont't exists");return}if(!t){console.error("validate function dont't exists");return}var p=s.split("|");var r=p[0];var u=p[1];var n=r.split(":"),q=[];if(n[1]){r=n[0];q=n[1].split(",").map(function(v){return v.replace(h,"")})}if(this.validates[r]){console.error("create "+r+" fail, this a validate exists")}this.validates[r]={errorInfo:u,fn:t,argvs:q,flag:o}}},{key:"setErrorInfo",value:function j(n,o){if(!this.validates[n]){console.error("update "+name+" fail, this a validate exists");return}this.validates[n].errorInfo=o}}]);return l})();b.exports=a});